
name: 'AzureBicepDeploy'

on:
  push:
    branches:
      - main
    
jobs:

  AzureBicepDeploy:
    name: 'AzureBicepDeploy'
    runs-on: 'ubuntu-latest'
    env:
      RGName: 'bicep-deploy-rg'
      RGLocation: 'northeurope'
    environment: production

    steps:
    - name: Checkout source code
      uses: actions/checkout@v2

    - name: Login to azure
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}

    #bild ARM from bicep
    - name: Run Bicep build
      uses: aliencube/bicep-build-actions@v0.3
      with:
        files: main.bicep

    # Checks the result
    - name: Check the result
      shell: bash
      run: |
        shopt -s globstar
        ls -altR **/sample*.*